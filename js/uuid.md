## 你了解 UUID 么？

### UUID 是什么？

UUID 的全称是 `Universally Unique Identifier`，中文为**通用唯一标识符**。本身是由一组 32 位数的 16 进制数字所构成，故 UUID 理论上的总数为 16^32=2^128，约等于 3.4 x 10^38。也就是说若每纳秒产生 1 兆个 UUID，要花 100 亿年才会将所有 UUID 使用完，也就是说最多 100 亿年的时间，UUID 将必定出现重复，不过 100 亿年地球是否存在也似乎不确定，暂时不必考虑那么长远。

UUID 的标准型式包含 32 个 16 进制数字，以连字号分为五段，形式为 8-4-4-4-12 的 32 个字符，如：550e8400-e29b-41d4-a716-446655440000。

FormatUUID 使用 16 进制表示，共有 36 个字符(32 个字母数字+4 个连接符"-")，格式为 8-4-4-4-12，如：6d25a684-9558-11e9-aa94-efccd7a0659b

`xxxxxxxx-xxxx-Mxxx-Nxxx-xxxxxxxxxxxx`

其中 M 与 N 都有特殊含义，M 表示 UUID 版本，目前只有五个版本，即只会出现 1，2，3，4，5，数字 N 的一至三个最高有效位表示 UUID 变体，目前只会出现 8，9，a，b 四种情况。

UUID 现有 5 种版本，是根据不同的使用场景划分的，而不是根据精度，所以 Version5 并不会比 Version1 精度高，在精度上，大家都能保证唯一性，重复的概率近乎于 0。

### Version1(date-time MAC address)

基于时间戳及 MAC 地址的 UUID 实现。它包括了 48 位的 MAC 地址和 60 位的时间戳。

```
5b01c826-9561-11e9-9659-cb41250df352
5b01cc7c-9561-11e9-965a-57ad522dee7f
5b01cea2-9561-11e9-965b-a3d050dd0f99
5b01cf60-9561-11e9-965c-1b66505f58da
5b01d118-9561-11e9-965d-97354eb9e996
```
相对于其它版本，v1 加入 48 位的 MAC 地址，这依赖于网卡供应商能提供唯一的 MAC 地址，同时也可能通过它反查到对应的 MAC 地址。Melissa 病毒就是这样做到的。

### Version2(date-time Mac address)

这是最神秘的版本，RFC 没有提供具体的实现细节，以至于大部分的 UUID 库都没有实现它，只在特定的场景(DCE security)才会用到。所以绝大数情况，我们也不会碰到它。

### Version3,5(namespace name-based)

V3 和 V5 都是通过 hash namespace 的标识符和名称生成的。V3 使用 MD5 作为 hash 函数，V5 则使用 SHA-1。因为里面没有不确定的部分，所以当 namespace 与输入参数确定时，得到的 UUID 都是确定唯一的。

```
2f67490d-55a4-395e-b540-457195f7aa95
2f67490d-55a4-395e-b540-457195f7aa95
2f67490d-55a4-395e-b540-457195f7aa95 可以看到这 3 个 UUID 都是一样的。具体的流程就是把
```

namespace 和输入参数拼接在一起，如"http://wwwbaidu.com" ++ "/query=uuid"；使用 MD5 算法对拼接后的字串进行 hash，截断为 128 位；把 UUID 的 Version 和 variant 字段都替换成固定的; 如果需要 to_string，需要转为 16 进制和加上连接符"-"。把 V3 的 hash 算法由 MD5 换成 SHA-1 就成了 V5。

### Version4(random)

这个版本使用最为广泛

```
a3535b78-69dd-4a9e-9a79-57e2ea28981b
a9ba3122-d89b-4855-85f1-92a018e5c457
7c59d031-a143-4676-a8ce-1b24200ab463
533831da-eab4-4c7d-a3f6-1e2da5a4c9a0
def539e8-d298-4575-b769-b55d7637b51e
```

其中 4 位代表版本，2-3 位代表 variant。余下的 122-121 位都是全部随机的。即有 2 的 122 次方(5.3 后面 36 个 0)个 UUID。一个标准实现的 UUID 库在生成了 2.71 万亿个 UUID 会产生重复 UUID 的可能性也只有 50% 的概率 这相当于每秒产生 10 亿的 UUID，持续 85 年，而把这些 UUID 都存入文件，每个 UUID 占 16bytes,总需要 45 EB(exabytes)，比目前最大的数据库(PB)还要大很多倍。

### Summary

-   如果只是需要生成一个唯一 ID,你可以使用 V1 或 V4。

    -   V1 基于时间戳和 Mac 地址,这些 ID 有一定的规律(你给出一个，是有可能被猜出来下一个是多少的)，而且会暴露你的 Mac 地址。

    -   V4 是完全随机(伪)的。

-   如果对于相同的参数需要输出相同的 UUID,你可以使用 V3 或 V5。

    -   V3 基于 MD5 hash 算法，如果需要考虑与其它系统的兼容性的话，就用它,因为它出来得早，大概率大家都是用它的。

    -   V5 基于 SHA-1 hash 算法，这个是首选。
